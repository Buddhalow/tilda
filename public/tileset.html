<!DOCTYPE html>
<html>
    <head>
        <title>Toolbar</title>
        <style>
             html, body {
		    overflow: hidden;
		    width: 100%;
		    height: 100%;
		    margin: 0;
		    padding: 0;
		      background-image: url('img/tileset.png');
                 
             }
		      #selection {
		          left: 0px;
		          top: 0px;
		          position: absolute;
		          
		          border: 1px solid blue;
		      }
        </style>
        <script>
       
        function Block(tile) {
        	
        		var parts = tile.split(' ');
        		this.tileX = parseInt(parts[0]);
        		this.tileY = parseInt(parts[1]);
        	
        		this.flags = parseInt(parts[2]);
        	
        }

        var tiles = [];
        var TILE_SIZE = 16;
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function () {
            if (xmlHttp.readyState == 4) {
                if (xmlHttp.status == 200) {
                    var lines = xmlHttp.responseText.split('\n');
                    for (var i in lines) {
                        tiles.push(new Block(lines[i]));
                    }
                    window.addEventListener('mousedown', function (event) {
                        var x = event.pageX;
                        var y = event.pageY;
                        var TILE_SIZE = 16;
                        var tileX = Math.floor((x + 1) / TILE_SIZE);
                        var tileY = Math.floor((y + 1) / TILE_SIZE);
                        var selection = document.querySelector('#selection');
                        selection.style.width = TILE_SIZE + 'px';
                        selection.style.height = TILE_SIZE + 'px';
                        selection.style.left = (tileX * TILE_SIZE) + 'px';
                        selection.style.top = (tileY * TILE_SIZE) + 'px';
                        var flags = 0;
                        for(var t in tiles) {
                            var tile = tiles[t];
                            if (tile.tileX == tileX && tile.tileY == tileY) {
                                flags = tile.flags;
                            }
                        }
                        window.opener.postMessage({
                            tile: {
                                x: tileX,
                                y: tileY,
                                flags: flags
                            }
                        }, '*');
                    });
                }
            }
        };
        xmlHttp.open('GET', '/t.tileset', true);
        xmlHttp.send(null);  
        </script>
    </head>
    <body>
        <div id="selection"></div>
    </body>
</html>